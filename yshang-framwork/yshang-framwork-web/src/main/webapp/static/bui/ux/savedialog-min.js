define("bui/ux/savedialog",["bui/common","bui/form","bui/overlay"],function(d){var e=d("bui/common"),a=d("bui/overlay"),c=d("bui/form");function b(f){b.superclass.constructor.call(this,f);this._init()}b.ATTRS={entityName:{},formId:{value:"form"},form:{},formCfg:{},submitUrl:{add:null,update:null},dialogContentId:{},dialog:{},dialogCfg:{},saveType:{},titlePrefix:{value:{add:"新增",update:"修改"}},events:{value:["beforeAddShow","beforeUpdateShow","beforeSubmit","afterSubmit"]}};e.extend(b,e.Base);e.augment(b,{_init:function(){var f=this;f._initForm();f._initdialog()},_initForm:function(){var f=this,h=f.get("form");if(!h){var g=e.merge(f.get("formCfg"),{srcNode:"#"+f.get("formId"),type:"post"});h=new e.Form.HForm(g);h.render();f.set("form",h)}},_initdialog:function(){var l=this,f=l.get("form");dialog=l.get("dialog");if(!dialog){var k=l.get("dialog"),k=l.get("dialogContentId"),m=l.get("entityName"),g=l.get("dialogCfg"),j=l.get("saveType");var h=function(){var p=l.set("saveType");var o=l.fire("beforeSubmit",dialog,f,p);if(typeof(o)!="undefined"&&!o){return false}f.valid();if(f.isValid()){f.ajaxSubmit({success:function(r){var s=l.set("saveType");var q=l.fire("afterSubmit",r,dialog,f,s);if(typeof(q)=="undefined"||q){if(r.success){e.Message.Alert("操作成功！","success");f.clearFields();dialog.close()}else{e.Message.Alert("操作失败："+r.msg,"warning")}}}})}};var n=function(){f.clearFields()};var i={title:"新增"+m,contentId:k,success:h,cancel:n};i=e.merge(i,g);dialog=new e.Overlay.Dialog(i);dialog.on("show",function(){f.clearErrors()});l.set("dialog",dialog)}},add:function(){var f=this,i=f.get("dialog"),k=f.get("form"),g=f.get("url"),j=f.get("titlePrefix"),h=f.get("entityName");var l=j["add"]?j["add"]:"";i.set("title",l+h);k.set("action",g["add"]);f.fire("beforeAddShow",i,k);i.show()},update:function(g){var f=this,j=f.get("dialog"),l=f.get("form"),h=f.get("url"),k=f.get("titlePrefix"),i=f.get("entityName");var m=k["update"]?k["update"]:"";f.set("saveType","update");j.set("title",m+i);l.set("action",h["update"]);if(g){l.setRecord(g)}f.fire("beforeUpdateShow",j,l,g);j.show()}});return b});